# 1. Тема и целевая аудитория

### Тема
ZOOM — это облачная платформа для проведения видео-конференций, вебинаров и других подобных онлайн мероприятий.

### Функционал MVP

- Авторизация
- Функционал видео-конференции:
   - Создание
   - Возможность приглашать участников
   - Отключение микрофона или камеры
   - Завершение

### Целевая аудитория
По официальным данным на 21 апреля 2020 года количество участников ежедневной встречи составляло около 300 млн пользователей. Сейчас это число составляет около 200 млн пользователей в день.

Пользователи приложения Zoom, как правило, относительно молоды. Основной целевой аудиторией являются люди в возрасте от 18 до 50 лет. 

Возрастная разбивка пользовательской базы приложения Zoom на iOS:

Возрастная группа | Доля пользователей
------------ | -------------
18-24 | 27%
25-34 | 23% <
35-49 | 22% <
50-64 | 19% <
65+ | 10% <

### Географическое распределение

Часть света | Доля пользователей
------------ | -------------
Австралия | 5.11%
Азия | 18.14%
Америка| 45.19%
Африка | 2.12%
Европа | 29.44%

# 2. Расчёт нагрузки

### Продуктовые метрики

- **Ежедневная аудитория** - 200 млн. чел
- **Средний размер хранилища на пользователя**:
    - Данные профиля 1 Мб: аватар и пользовательские данные
    - Записи видеозвонков в облачном хранилище(около 10% пользователей): Предположим, что в среднем пользователь сохраняет 2 часа видео записей в месяц в облачном хранилище. Возьмём разрешение записи в среднем 720p. Тогда объём записи будет составлять около 1 Гб в час. Следовательно, получаем, что пользователь за месяц занимает 2 Гб хранилища. В год на 1 пользователя уходит 24 Гб памяти. 
- **Среднее количество действий пользователя по типам за период**

Вид действия | Количество/Период
------------ | -------------
Создание конференции | 5 в месяц
Видео-разговор | 10 часов в месяц
Приглашение пользователя на конференцию | 10 в месяц
Смена аватарки | 1 в месяц
Смена имени пользователя | 1 в месяц
Отправка сообщения в чат | 30 в месяц
Сохранение записи локально | 2 в месяц
Сохранение записи в облаке | 1 в месяц

### Технические метрики

- **Размер хранения**
    - Профиль = 200.000.000 * 1Мб = 200.000 Гб
    - Записи видео-звонков = 24 Гб * 200.000.000 = 4,8млн Тб за год
    - Записи чатов = 83,3 Гб/час * 24 * 30 * 12 * 0,2(коэфф. сохранённых чатов) = 143.942 Гб за год
    - Хранилище сессий конференций = 38,5 Мб/сек * 1час(средняя продолжительность конференции) = 138,6 Гб
- **Сетевой трафик**
    - Видео-разговор = 1Гб/час * (10 * 200.000.000 / 30 / 24) = 2.777.777,8 Гб/час
    - Отправка сообщения в чат = 30 * 20Кб * 200.000.000 / 30 / 24 = 83,3 Гб/час
    - Создание конференции = 385 * 100Кб = 38,5 Мб/сек
    - Приглашение пользователя на конференцию = 772 * 20Кб = 15,44 Мб/сек
    - Смена аватарки = 77 * 1Мб = 77Мб/сек
    - Сохранение записи в облаке = 154,3 Гб/сек  = 4,8млн Тб/год
- **Сетевой трафик при прике нагрузки**
    - Видео-разговор = 1Гб/час * (10 * 300.000.000 / 30 / 24) = 4.166.666,7 Гб/час
    - Отправка сообщения в чат = 30 * 20Кб * 300.000.000 / 30 / 24 = 124,95 Гб/час
    - Создание конференции = 577 * 100Кб = 57,7 Мб/сек
    - Приглашение пользователя на конференцию = 1158 * 20Кб = 23,16 Мб/сек
    - Смена аватарки = 115 * 1Мб = 155 Мб/сек
    - Сохранение записи в облаке = 2314 Гб/сек
- **RPS в разбивке по типам запросов**

Вид действия | RPS
------------ | -------------
Создание конференции | 385
Видео-разговор | 5.401
Приглашение пользователя на конференцию | 772
Смена аватарки | 77
Смена имени пользователя | 77
Отправка сообщения в чат | 2.314
Сохранение записи локально | 154
Сохранение записи в облаке | 77

# 3. Логическая схема

![Screenshot 2021-12-11 at 22 19 08](https://user-images.githubusercontent.com/57917516/145688918-6019fc16-b105-4419-9687-60f750d5412a.png)

# 4. Физическая схема

![Untitled drawio](https://user-images.githubusercontent.com/57917516/145689354-8200223a-cdb6-4674-ac26-2e6182ddbd12.png)

ИНДЕКСЫ:
- На таблицу user навесим индексы на nickname и image_url, потому что наиболее частые запросы для юзера - получить никнейм с аватаркой.
- Также стоит учесть, что на все primary key и foren key идет автоматическая индексация.

Также будет хранить сообщения в отсортированном ввиде по дате для того, чтобы быстро получать новые сообщения.

Таблицы conferense, user, messages, conference_members не будут иметь большую нагрузку, поэтому мы будет хранить их в PostgreSQL. Таблица sessions будет использоваться при входе польхователя в аккаунт, что происходит довольно часто, поэтому для нее будем использовать Tarantool, чтобы данные о сессиях быстро отдавались пользователям. 

Для всех БД будем использовать репликацию Master-Slave для увеличения надежности данных. Также для всех БД настроим шардирование по полю ID и будем рассполагать данные на разные сервера через каждые N полей. Для каждой БД число N будет разным из-за различного объема хранимых данных.

# 5. Технологии


Название | Область применения | Мотивация
------------ | ------------- | -------------
Ubuntu Server | OS | Стабильная, легко настраиваемая
Nginx | load balancer | Из коробки поддерживает методы балансировки. Удобный. Высокая скорость работы. Легко настроить.
Golang | Backend | Скорость работы, скорость компиляции, легкость разработки.
C++ | Desctop Client App | Высокая скорость работы, Кроссплатформенность (библиотека QT).
Postgres | DB(conferense, user, messages, conference_members) | Надежность, мощные и надёжные механизмы транзакций и репликации.
Tarantool | DB(sessions) | Скорость работы
Amazon S3 | Хранение файлов |Не нужно беспокоиться о хранении видео и изображений, Amazon все делаем сам

Бекенд стоит разделить на несколько сервисов для увеличения надежности, возможности маштабирования:
- Сервиса авторизации
- Сервис видеозвонков
   - микросервис загрузки видео/аудио
   - микросервис перекодировки видео
   - микросервис раздачи видео/аудио
- Сервис сообщений

# Используемые источники

- https://backlinko.com/zoom-users
- https://www.reviews.org/internet-service/how-much-data-does-zoom-use/
